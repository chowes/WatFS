syntax = "proto3";

package watfs;

service WatFS {
    // basically just works like a ping, no work is done
    rpc WatFSNull (WatFSStatus) returns (WatFSStatus) {}

    // get object attributes
    rpc WatFSGetAttr (WatFSGetAttrArgs) returns (WatFSGetAttrRet) {}

    // lookup an object and return a file handle
    rpc WatFSLookup (WatFSLookupArgs) returns (WatFSLookupRet) {}

    
}


/* NULL */

/*
 * Right now just used to implement the NULL call, not sure if this will have
 * any practical use. I only bothered to implement it as a starting point.
 */
message WatFSStatus {
    int32 status = 1;
}

/* GETATTR */ 

/*
 * All we need to send is the file path
 */
message WatFSGetAttrArgs {
    string file_path = 1;
}

/*
 * Server sends back the results of a call to stat in attr, and sets err to the
 * value of errno if there is an error. This field will be 0 in the non-error
 * case. 
 */
message WatFSGetAttrRet {
    // cast to struct stat *
    int32 err = 1;
    bytes attr = 2;
}

/* LOOKUP */ 

/*
 * Client sends the file handle of the containing directory, and the file 
 * handle as a string
 */
message WatFSLookupArgs {
    string dir_handle = 1;
    string file_name = 2;
}

/*
 * Server replies with a file handle for the requested object (can be either
 * a file or a directory), the attributes of the requested object, and the
 * attributes of the containing folder
 */
message WatFSLookupRet {
    string file_handle = 1;
    bytes file_attr = 2;
    bytes dir_attr = 3;
    int32 err = 4;
}
